import { Contributors } from '@/components/Contributors'
import { Resources } from '@/components/Resources'
import { Guides } from '@/components/Guides'

export const description = 'Implement message queues for better resource management'

# Fast Entires

## How to modularize flows {{not:'true'}}

As our projects grow we will need to implement a better way to maintain the project, in this case it is highly recommended to implement a module view.

In the following example we will show how we have migrated the modules to a directory, as well as the provider and the database.

<CodeGroup>
```ts {{ title: 'app.ts' }}
const messageQueue: {text:string, timestamp: number}[] = [];

const GAP_SECONDS = 3000

let messageTimer = null;

async function enqueueMessage(message: string): Promise<void> {
    messageQueue.push({ text: message, timestamp: Date.now() });

    return new Promise((resolve) => {
        if (messageTimer) {
            clearTimeout(messageTimer);
        }

        messageTimer = setTimeout(() => {
            resolve(processMessageQueue());
        }, GAP_SECONDS);
    });
}

function processMessageQueue(): string {
    if (messageQueue.length === 0) return '';

    const combinedMessage = messageQueue.map(message => message.text).join(" ");
    messageQueue.length = 0;
    return combinedMessage;
}

export { enqueueMessage, processMessageQueue };
```
</CodeGroup>

An example of the scaffolding you can use in your project. Or a more user friendly folder structure.

```ts {{title:'Tree'}}
const { isMedia } = require("../layer/utils/mediaValidator");
const { enqueueMessage } = require("../layer/utils/messageHandler");
const {handlerAI} = require('../layer/utils/voicenoteHandler');
const { isVoiceNote } = require("../layer/utils/voicenoteValidator");

module.exports = async (ctx, ctxFn) => {
  let userMessage
  if(isVoiceNote(ctx.body)){
    userMessage = await handlerAI(ctx);
    console.log("vn:", userMessage)
  }
  if(isMedia(ctx.body)){
    userMessage = '*Se envio una imagen*'
  }
  else{
    userMessage = ctx.body;
  }

  let body = String(await enqueueMessage(userMessage));
  console.log(body)
```
----

<Guides />

<Resources />

<Contributors users={['leifermendez']} />