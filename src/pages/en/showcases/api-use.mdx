import { Contributors } from '@/components/Contributors'
import { Resources } from '@/components/Resources'
import { Guides } from '@/components/Guides'

# API?

In many occasions we need to send a message via HTTP request is very useful to send reminders or order confirmations. In this case each provider implements a `handleCtx` function which allows you to inject the bot instantiation and access its functions from a controller.

<Error>
It is important to use this function under your own responsibility, since abusive use may be considered as spam and your number may be blocked.
</Error>

## Example API

  <CodeGroup title="Request" tag="POST" label="/v1/messages">
  ```bash {{ title: 'Message' }}
  curl https://api.example.chat/v1/messages \
    -d number="34000000" \
    -d message="Hello!"
  ```
  ```bash {{ title: 'Media' }}
  curl https://api.example.chat/v1/messages \
    -d number="34000000" \
    -d media="https://i.imgur.com/0HpzsEm.png" \
    -d message="Hello!"
  ```
  </CodeGroup>

In the exercise below you can get an example of how it works. It is interesting to understand that internally the library already implements a very light version of HTTP similar to express but called [polka](https://github.com/lukeed/polka/tree/main).

<CodeGroup>

```ts {{title:'app.ts'}}
import 'dotenv/config'
import { createBot, MemoryDB, createProvider } from '@bot-whatsapp/bot'
import { BaileysProvider, handleCtx } from '@bot-whatsapp/provider-baileys'
import flow from './flows';

const PORT = process.env.PORT ?? 3001

const main = async () => {
    const provider = createProvider(BaileysProvider)
    await createBot({
        database: new MemoryDB(),
        provider,
        flow,
    })

    provider.initHttpServer(+PORT)
    provider.http.server.post('/v1/messages', handleCtx(async (bot, req, res) => {
        const { number, message } = req.body
        await bot.sendMessage(number, message, {})
        return res.end('send')
    }))
}

main()
```
```ts {{title:'app-media.ts'}}
import 'dotenv/config'
import { createBot, MemoryDB, createProvider } from '@bot-whatsapp/bot'
import { BaileysProvider, handleCtx } from '@bot-whatsapp/provider-baileys'
import flow from './flows';

const PORT = process.env.PORT ?? 3001

const main = async () => {
    const provider = createProvider(BaileysProvider)
    await createBot({
        database: new MemoryDB(),
        provider,
        flow,
    })

    provider.initHttpServer(+PORT)
    provider.http.server.post('/v1/messages', handleCtx(async (bot, req, res) => {
        const { number, message, media } = req.body
        await bot.sendMessage(number, message, { media }) // https://i.imgur.com/0HpzsEm.png
        return res.end('send')
    }))
}

main()
```
</CodeGroup>



---

<Guides />

<Resources />

<Contributors users={['leifermendez','lualreye']} />